<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T & L | Agendamento</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rye&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* CSS GLOBAL */
        body {
            background-color: #0f0f0f;
            background-image: repeating-linear-gradient(45deg, #0f0f0f, #0f0f0f 10px, #1a1a1a 10px, #1a1a1a 20px);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: 'Roboto Slab', serif;
        }

        /* NAVBAR */
        .navbar-custom {
            background-color: rgba(15, 15, 15, 0.95);
            border-bottom: 2px solid #FFD700;
            padding: 15px 0;
            font-family: 'Rye', serif;
        }
        .navbar-brand { font-size: 1.5rem; color: #FFD700 !important; }
        .nav-link { color: white !important; font-size: 1.1rem; margin: 0 10px; transition: color 0.3s; }
        .nav-link:hover, .nav-link.active { color: #FFD700 !important; }
        
        .flex-grow-content { flex: 1; width: 100%; display: flex; align-items: center; justify-content: center; }

        /* --- FORMUL√ÅRIO DE AGENDAMENTO --- */
        .agendamento-container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
        }

        .main-title { 
            font-family: 'Rye', serif; 
            color: #FFD700; 
            font-size: 3rem; 
            text-align: center;
            margin-bottom: 5px;
        }
        
        .sub-title {
            text-align: center;
            color: #ccc;
            margin-bottom: 40px;
            font-size: 1rem;
        }

        /* Inputs Estilizados */
        .form-label { color: #ccc; margin-top: 15px; font-weight: bold; }
        
        .custom-input, .custom-select {
            background-color: #1a1a1a;
            border: 1px solid #FFD700;
            color: #999;
            border-radius: 10px;
            padding: 12px;
            width: 100%;
        }
        
        .custom-input:focus, .custom-select:focus {
            background-color: #252525;
            color: white;
            outline: none;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        /* --- NOVO: CONTAINER DE CHECKBOXES (M√∫ltipla Escolha) --- */
        .checkbox-group-container {
            background-color: #1a1a1a;
            border: 1px solid #FFD700;
            border-radius: 10px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto; /* Permite rolar se tiver muitos servi√ßos */
        }
        
        .form-check { margin-bottom: 8px; }
        
        .form-check-input {
            background-color: #0f0f0f;
            border-color: #FFD700;
            cursor: pointer;
        }
        
        .form-check-input:checked {
            background-color: #FFD700;
            border-color: #FFD700;
        }
        
        .form-check-label {
            color: white;
            margin-left: 8px;
            cursor: pointer;
        }

        /* Bot√£o Confirmar */
        .btn-confirmar {
            background-color: transparent;
            border: 2px solid #FFD700;
            color: #FFD700;
            font-family: 'Rye', serif;
            font-size: 1.2rem;
            width: 100%;
            padding: 10px;
            border-radius: 25px;
            margin-top: 30px;
            transition: all 0.3s;
        }
        
        .btn-confirmar:hover {
            background-color: #FFD700;
            color: #000;
            transform: scale(1.02);
        }

        /* Feedback de Erro */
        .error-msg {
            color: #ff4444;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
        }

        /* Footer */
        .footer { background-color: rgba(15, 15, 15, 0.95); border-top: 2px solid #FFD700; padding: 20px 0; margin-top: auto; width: 100%; }
        .footer-item { display: flex; align-items: center; justify-content: center; gap: 10px; color: #fff; font-size: 14px; }
        .footer-item i { color: #FFD700; font-size: 18px; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container">
            <a class="navbar-brand" href="index.html">T & L | BarberShop</a>
            <button class="navbar-toggler bg-warning" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="index.html">In√≠cio</a></li>
                    <li class="nav-item"><a class="nav-link" href="servicos.html">Servi√ßos</a></li>
                    <li class="nav-item"><a class="nav-link" href="horarios.html">Hor√°rios</a></li>
                    <li class="nav-item"><a class="nav-link active" href="agendamento.html">Agendamento</a></li>
                    <li class="nav-item"><a class="nav-link" href="meusAgendamentos.html">Meus Agendamentos</a></li>
                    <li class="nav-item"><a class="nav-link" href="nossoTime.html">Nosso time</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Quem somos</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="flex-grow-content">
        <div class="agendamento-container">
            <h1 class="main-title"><i class="far fa-calendar-check"></i> Agendamento</h1>
            <p class="sub-title">Preencha as informa√ß√µes a seguir para agendarmos o seu servi√ßo</p>

            <form id="formPaginaAgendamento">
                
                <label class="form-label">Quais servi√ßos voc√™ deseja?</label>
                <div class="checkbox-group-container" id="containerServicos">
                    <p class="text-muted text-center" style="font-size:0.9rem;">Carregando servi√ßos...</p>
                </div>
                <div class="error-msg" id="erroServico">Selecione pelo menos um servi√ßo!</div>

                <label class="form-label">Nome Completo</label>
                <input type="text" class="custom-input" id="inputNome" placeholder="Como quer ser chamado?" required maxlength="50">

                <label class="form-label">CPF (Obrigat√≥rio)</label>
                <input type="text" class="custom-input" id="inputCPF" placeholder="000.000.000-00" required maxlength="14">
                <div class="error-msg" id="erroCPF">CPF Inv√°lido!</div>

                <label class="form-label">WhatsApp</label>
                <input type="tel" class="custom-input" id="inputWpp" placeholder="(00) 00000-0000" required maxlength="15">
                <div class="error-msg" id="erroWpp">N√∫mero incompleto!</div>

                <label class="form-label">Data do Agendamento</label>
                <input type="date" class="custom-input" id="inputData" required>

                <label class="form-label">Hor√°rio Dispon√≠vel</label>
                <select class="custom-select" id="inputHora" required>
                    <option value="" selected disabled>Selecione um hor√°rio</option>
                    <option value="08:00">08:00</option>
                    <option value="09:00">09:00</option>
                    <option value="10:00">10:00</option>
                    <option value="11:00">11:00</option>
                    <option value="13:00">13:00</option>
                    <option value="14:00">14:00</option>
                    <option value="15:00">15:00</option>
                    <option value="16:00">16:00</option>
                    <option value="17:00">17:00</option>
                    <option value="18:00">18:00</option>
                    <option value="19:00">19:00</option>
                </select>

                <button type="submit" class="btn-confirmar">Confirmar Agendamento</button>
            </form>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="row text-center">
                <div class="col-12"><div class="footer-item"><span>T & L BarberShop System</span></div></div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // CONFIGURA√á√ÉO: N√öMERO DO BARBEIRO
        const NUMERO_BARBEIRO = "5585982083975"; 

        // 1. CARREGAR OS SERVI√áOS (AGORA COM CHECKBOXES)
        const containerServicos = document.getElementById('containerServicos');
        const servicosSalvos = JSON.parse(localStorage.getItem('meusServicos')) || [];

        containerServicos.innerHTML = ''; // Limpa

        if (servicosSalvos.length > 0) {
            servicosSalvos.forEach(serv => {
                const div = document.createElement('div');
                div.className = 'form-check';
                
                div.innerHTML = `
                    <input class="form-check-input servico-checkbox" type="checkbox" value="${serv.nome}" id="chk_${serv.nome}">
                    <label class="form-check-label" for="chk_${serv.nome}">
                        ${serv.nome} <span style="color: #FFD700; font-size: 0.9em;">(R$ ${parseFloat(serv.preco).toFixed(2)})</span>
                    </label>
                `;
                containerServicos.appendChild(div);
            });
        } else {
            containerServicos.innerHTML = '<p class="text-muted text-center pt-2">Nenhum servi√ßo cadastrado no admin.</p>';
        }

        // 2. M√ÅSCARAS E VALIDA√á√ïES
        const inputCPF = document.getElementById('inputCPF');
        inputCPF.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, "");
            value = value.replace(/(\d{3})(\d)/, "$1.$2");
            value = value.replace(/(\d{3})(\d)/, "$1.$2");
            value = value.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
            e.target.value = value;
        });

        const inputWpp = document.getElementById('inputWpp');
        inputWpp.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, "");
            if (value.length > 11) value = value.slice(0, 11);
            if (value.length > 2) value = `(${value.slice(0, 2)}) ${value.slice(2)}`;
            if (value.length > 9) value = `${value.slice(0, 10)}-${value.slice(10)}`;
            e.target.value = value;
        });

        function validarCPF(cpf) {
            cpf = cpf.replace(/[^\d]+/g,'');	
            if(cpf == '') return false;	
            if (cpf.length != 11 || /^(\d)\1+$/.test(cpf)) return false;
            let add = 0;	
            for (let i=0; i < 9; i ++) add += parseInt(cpf.charAt(i)) * (10 - i);	
            let rev = 11 - (add % 11);	
            if (rev == 10 || rev == 11) rev = 0;	
            if (rev != parseInt(cpf.charAt(9))) return false;		
            add = 0;	
            for (let i = 0; i < 10; i ++) add += parseInt(cpf.charAt(i)) * (11 - i);	
            rev = 11 - (add % 11);	
            if (rev == 10 || rev == 11) rev = 0;	
            if (rev != parseInt(cpf.charAt(10))) return false;		
            return true;   
        }

        // 3. SALVAR, ENVIAR ZAP E REDIRECIONAR
        document.getElementById('formPaginaAgendamento').addEventListener('submit', function(e) {
            e.preventDefault();

            // Pega todos os checkboxes marcados
            const checkboxes = document.querySelectorAll('.servico-checkbox:checked');
            let servicosSelecionados = [];
            checkboxes.forEach((checkbox) => {
                servicosSelecionados.push(checkbox.value);
            });

            const nome = document.getElementById('inputNome').value;
            const cpf = document.getElementById('inputCPF').value;
            const wpp = document.getElementById('inputWpp').value;
            const data = document.getElementById('inputData').value;
            const hora = document.getElementById('inputHora').value;

            // VALIDA√á√ïES
            let temErro = false;

            // Valida Servi√ßo
            if (servicosSelecionados.length === 0) {
                document.getElementById('erroServico').style.display = 'block';
                temErro = true;
            } else {
                document.getElementById('erroServico').style.display = 'none';
            }

            // Valida CPF
            if(!validarCPF(cpf)) {
                document.getElementById('erroCPF').style.display = 'block';
                temErro = true;
            } else {
                document.getElementById('erroCPF').style.display = 'none';
            }

            // Valida Whatsapp
            const wppNumeros = wpp.replace(/\D/g, "");
            if(wppNumeros.length < 11) {
                document.getElementById('erroWpp').style.display = 'block';
                temErro = true;
            } else {
                document.getElementById('erroWpp').style.display = 'none';
            }

            if(temErro) return;

            // --- A. SALVAR ---
            const novoAgendamento = {
                id: Date.now(),
                cliente: nome,
                cpf: cpf,
                whatsapp: wpp,
                servico: servicosSelecionados.join(" + "), // Junta os nomes com +
                data: data,
                hora: hora
            };

            const listaAgendamentos = JSON.parse(localStorage.getItem('meusAgendamentos')) || [];
            listaAgendamentos.push(novoAgendamento);
            localStorage.setItem('meusAgendamentos', JSON.stringify(listaAgendamentos));

            // --- B. ENVIAR WHATSAPP ---
            const dataBR = data.split('-').reverse().join('/');
            
            const textoMensagem = `Ol√°, sou *${nome}* (CPF: ${cpf}).%0AGostaria de agendar:%0A‚úÇÔ∏è *${servicosSelecionados.join(" + ")}*%0AüìÖ Data: ${dataBR}%0A‚è∞ Hor√°rio: ${hora}`;
            
            const linkZap = `https://wa.me/${NUMERO_BARBEIRO}?text=${textoMensagem}`;

            window.open(linkZap, '_blank');

            // --- C. REDIRECIONAR ---
            alert('Agendamento confirmado! Redirecionando para seus agendamentos...');
            window.location.href = 'meusAgendamentos.html';
        });
    </script>
</body>
</html>