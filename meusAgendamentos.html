<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T & L | Meus Agendamentos</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rye&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* CSS GLOBAL */
        body {
            background-color: #0f0f0f;
            background-image: repeating-linear-gradient(45deg, #0f0f0f, #0f0f0f 10px, #1a1a1a 10px, #1a1a1a 20px);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: 'Roboto Slab', serif;
            margin: 0;
        }
        .navbar-custom {
            background-color: rgba(15, 15, 15, 0.95);
            border-bottom: 2px solid #FFD700;
            padding: 15px 0;
            font-family: 'Rye', serif;
        }
        .navbar-brand { font-size: 1.5rem; color: #FFD700 !important; }
        .nav-link { color: white !important; font-size: 1.1rem; margin: 0 10px; transition: color 0.3s; }
        .nav-link:hover, .nav-link.active { color: #FFD700 !important; }
        .flex-grow-content { flex: 1; width: 100%; }

        .page-header { text-align: center; margin-top: 40px; margin-bottom: 40px; }
        .main-title { 
            font-family: 'Rye', serif; color: #FFD700; font-size: 3rem; 
            display: flex; align-items: center; justify-content: center; gap: 15px;
        }
        .sub-title { font-size: 1.2rem; color: #e0e0e0; margin-top: 10px; font-family: 'Rye', serif; }

        .appointment-list { max-width: 900px; margin: 0 auto; padding: 0 15px; }
        
        .appointment-item {
            border: 2px solid white;
            border-radius: 50px;
            padding: 15px 30px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.3);
            transition: transform 0.2s;
        }
        .appointment-item:hover { border-color: #FFD700; transform: scale(1.02); }
        
        .appointment-info { text-align: left; }
        .appointment-text {
            color: #FFD700;
            font-family: 'Roboto Slab', serif;
            font-weight: 900;
            font-style: italic;
            font-size: 1.1rem;
            text-transform: uppercase;
            margin: 0;
        }
        .appointment-date { color: #ccc; font-size: 0.9rem; margin: 0; }

        .action-btn { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; }
        .action-btn:hover { color: #FFD700; }
        .btn-delete:hover { color: #ff4444; }

        .footer { background-color: rgba(15, 15, 15, 0.95); border-top: 2px solid #FFD700; padding: 20px 0; margin-top: auto; width: 100%; }
        .footer-item { display: flex; align-items: center; justify-content: center; gap: 10px; color: #fff; font-size: 14px; }
        .footer-item i { color: #FFD700; font-size: 18px; }
        
        @media (max-width: 768px) {
            .appointment-item { flex-direction: column; text-align: center; gap: 15px; border-radius: 20px; }
            .appointment-info { text-align: center; }
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container">
            <a class="navbar-brand" href="index.html">T & L | BarberShop</a>
            <button class="navbar-toggler bg-warning" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link active" href="index.html">In√≠cio</a></li>
                    <li class="nav-item"><a class="nav-link" href="servicos.html">Servi√ßos</a></li>
                    <li class="nav-item"><a class="nav-link" href="horarios.html">Hor√°rios</a></li>
                    <li class="nav-item"><a class="nav-link" href="agendamento.html">Agendamento</a></li>
                    <li class="nav-item"><a class="nav-link" href="meusAgendamentos.html">Meus Agendamentos</a></li>
                    <li class="nav-item"><a class="nav-link" href="nossotime.html">Nosso Time</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Quem somos</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container flex-grow-content">
        <div class="page-header">
            <h1 class="main-title"><i class="fas fa-barcode fa-rotate-90"></i> Meus agendamentos</h1>
            <p class="sub-title">Aqui vc ver seus agendamentos</p>
        </div>

        <div class="appointment-list" id="listaAgendamentos">
            <p class="text-center text-muted">Carregando...</p>
        </div>
    </div>

    <footer class="footer">
        <div class="container"><div class="row text-center"><div class="col-12"><div class="footer-item"><span>T & L BarberShop System</span></div></div></div></div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // --- IMPORTANTE: COLOQUE O N√öMERO DO BARBEIRO AQUI ---
        const NUMERO_BARBEIRO = "5585982083975"; 

        // Fun√ß√£o auxiliar para data bonita
        function formatarData(dataISO) {
            if(!dataISO) return "";
            const [ano, mes, dia] = dataISO.split('-');
            return `${dia}/${mes}/${ano}`;
        }

        function renderizarAgendamentos() {
            const container = document.getElementById('listaAgendamentos');
            const agendamentos = JSON.parse(localStorage.getItem('meusAgendamentos')) || [];

            container.innerHTML = '';

            if (agendamentos.length === 0) {
                container.innerHTML = '<h4 class="text-center text-secondary">Voc√™ ainda n√£o tem agendamentos.</h4>';
                return;
            }

            // Ordena por data (do mais pr√≥ximo para o mais distante)
            agendamentos.sort((a, b) => new Date(a.data) - new Date(b.data));

            agendamentos.forEach(item => {
                const div = document.createElement('div');
                div.className = 'appointment-item';
                div.innerHTML = `
                    <div class="appointment-info">
                        <h3 class="appointment-text">${item.servico} - ${item.cliente}</h3>
                        <p class="appointment-date">
                            <i class="far fa-calendar"></i> ${formatarData(item.data)} √†s ${item.hora} 
                            <span class="text-warning ms-2">| CPF: ${item.cpf}</span>
                        </p>
                    </div>
                    <div class="appointment-actions">
                        <button class="action-btn" title="Editar" onclick="alert('Funcionalidade em desenvolvimento!')"><i class="far fa-edit"></i></button>
                        <button class="action-btn btn-delete" title="Cancelar e Avisar Barbeiro" onclick="deletarAgendamento(${item.id})"><i class="far fa-trash-alt"></i></button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // --- FUN√á√ÉO DE DELETAR COM AVISO NO WHATSAPP ---
        function deletarAgendamento(id) {
            // 1. Pega a lista atual
            let agendamentos = JSON.parse(localStorage.getItem('meusAgendamentos')) || [];
            
            // 2. Encontra o item que ser√° apagado para pegar os dados dele
            const itemParaCancelar = agendamentos.find(ag => ag.id === id);

            if (itemParaCancelar) {
                if(confirm(`Tem certeza que deseja CANCELAR o agendamento de ${itemParaCancelar.servico}? Isso ir√° abrir o WhatsApp para avisar o barbeiro.`)) {
                    
                    // 3. Monta a mensagem de Cancelamento
                    const dataFormatada = formatarData(itemParaCancelar.data);
                    const mensagem = `Ol√°, sou *${itemParaCancelar.cliente}* (CPF: ${itemParaCancelar.cpf}).%0A%0AGostaria de *CANCELAR* o meu agendamento:%0Aüö´ Servi√ßo: ${itemParaCancelar.servico}%0AüìÖ Data: ${dataFormatada}%0A‚è∞ Hor√°rio: ${itemParaCancelar.hora}%0A%0ADesculpe o transtorno.`;

                    const linkZap = `https://wa.me/${NUMERO_BARBEIRO}?text=${mensagem}`;

                    // 4. Abre o WhatsApp
                    window.open(linkZap, '_blank');

                    // 5. Remove do banco de dados (localStorage)
                    agendamentos = agendamentos.filter(ag => ag.id !== id);
                    localStorage.setItem('meusAgendamentos', JSON.stringify(agendamentos));

                    // 6. Atualiza a tela
                    renderizarAgendamentos();
                }
            }
        }

        // Inicia
        renderizarAgendamentos();
    </script>
</body>
</html>